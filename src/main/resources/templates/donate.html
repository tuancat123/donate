<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml" lang="vi">
<head>
  <meta charset="UTF-8">
  <title>QuyÃªn gÃ³p - Quá»¹ Tá»« Thiá»‡n</title>
  <link rel="stylesheet" th:href="@{/css/index.css}">
  <script>
    function togglePaymentFields() {
      const method = document.querySelector('input[name="paymentMethod"]:checked').value;
      document.getElementById("bank-info").style.display = (method === "BANK") ? "block" : "none";
      document.getElementById("momo-info").style.display = (method === "MOMO") ? "block" : "none";
    }
    window.addEventListener("DOMContentLoaded", togglePaymentFields);
  </script>
</head>

<body>

<!-- ğŸŒ¸ Navbar -->
<header class="navbar">
  <div class="logo">
    <span class="logo-icon">ğŸ’–</span>
    <span class="logo-text">Quá»¹ Tá»« Thiá»‡n</span>
  </div>
  <nav class="nav-links">
    <a href="/" >Trang chá»§</a>
    <a href="/campaigns">Chiáº¿n dá»‹ch</a>
    <a href="/donate" class="active">QuyÃªn gÃ³p</a>
    <a href="/stats">Thá»‘ng kÃª</a>

    <!-- ChÆ°a Ä‘Äƒng nháº­p -->
    <a href="/login" sec:authorize="!isAuthenticated()">ÄÄƒng nháº­p</a>
    <a href="/register" sec:authorize="!isAuthenticated()">ÄÄƒng kÃ½</a>

    <!-- ÄÃ£ Ä‘Äƒng nháº­p -->
    <span sec:authorize="isAuthenticated()" class="user-info">
      Xin chÃ o, <strong sec:authentication="name"></strong>!
      <a href="/profile" class="profile-link">Há»“ sÆ¡</a>
      <form th:action="@{/logout}" method="post" class="logout-form">
        <button type="submit" class="logout-btn">ÄÄƒng xuáº¥t</button>
      </form>
    </span>
  </nav>
</header>

<!-- ğŸ’— Donate Form -->
<section class="donate-section">
  <div class="donate-card">
    <h2>QuyÃªn gÃ³p ngay hÃ´m nay</h2>
    <p class="subtitle">HÃ£y cÃ¹ng chung tay giÃºp Ä‘á»¡ nhá»¯ng hoÃ n cáº£nh khÃ³ khÄƒn â¤ï¸</p>

    <form th:action="@{/donate}" method="post" th:object="${donation}" class="donate-form">

      <!-- ğŸ’° Sá»‘ tiá»n -->
      <label for="amount">Sá»‘ tiá»n quyÃªn gÃ³p (VND)</label>
      <input type="number" id="amount" th:field="*{amount}" min="1000" required>

      <!-- ğŸ¯ Chá»n chiáº¿n dá»‹ch -->
      <label for="campaign">Chá»n chiáº¿n dá»‹ch</label>
      <select id="campaign" name="campaignId"
              onchange="window.location = /*[[@{/donate}]]*/ '?campaignId=' + this.value">
        <option value="">-- Chá»n chiáº¿n dá»‹ch --</option>
        <option th:each="c : ${campaigns}"
                th:value="${c.campaignId}"
                th:text="${c.title}">
        </option>
      </select>


      <script>
            function reloadPage() {
                const id = document.getElementById("campaign").value;
                if (id) {
                    window.location.href = "/donate?campaignId=" + id;
                }
            }
      </script>


      <!-- ğŸ’³ PhÆ°Æ¡ng thá»©c thanh toÃ¡n -->
      <label>PhÆ°Æ¡ng thá»©c thanh toÃ¡n</label>
      <div class="payment-options">
        <label>
          <input type="radio" name="paymentMethod" value="BANK" checked onclick="togglePaymentFields()"> NgÃ¢n hÃ ng
        </label>
        <label>
          <input type="radio" name="paymentMethod" value="MOMO" onclick="togglePaymentFields()"> VÃ­ MoMo
        </label>
      </div>

      <!-- ğŸ¦ ThÃ´ng tin tÃ i khoáº£n nháº­n (BANK) -->
      <div id="bank-info">
        <p><strong>TÃ i khoáº£n nháº­n quyÃªn gÃ³p:</strong></p>
        <ul>
          <li th:each="b : ${selectedBanks}">
            <span th:text="${b.bankName}"></span> -
            <span th:text="${b.accountNumber}"></span> -
            <span th:text="${b.accountHolder}"></span>
          </li>
        </ul>
      </div>

      <!-- ğŸ“± ThÃ´ng tin MoMo -->
      <div id="momo-info" style="display:none;">
        <p>DÃ¹ng á»©ng dá»¥ng <strong>MoMo</strong> Ä‘á»ƒ quÃ©t QR:</p>
        <img th:each="m : ${selectedMomos}"
             th:src="@{'https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=' + ${m.phoneNumber}}"
             alt="QR MoMo" class="qr-code">
      </div>

      <!-- ğŸ’Œ Lá»i nháº¯n -->
      <label for="message">Lá»i nháº¯n (khÃ´ng báº¯t buá»™c)</label>
      <textarea id="message" th:field="*{message}" placeholder="Gá»­i lá»i chÃºc, lá»i nháº¯n..."></textarea>

      <button type="submit" class="btn-hero">Gá»­i quyÃªn gÃ³p</button>
    </form>
  </div>
</section>

<footer>
  <p>Â© 2025 Quá»¹ Tá»« Thiá»‡n - Lan tá»a yÃªu thÆ°Æ¡ng</p>
</footer>

</body>
</html>
